<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Corrida Menongue - Subway Surf 3D Matem√°tica</title>
<style>
body {margin:0; font-family:Poppins,sans-serif; overflow:hidden; background:#87CEEB;}
header {background:#0d47a1; color:white; padding:10px; display:flex; align-items:center; gap:10px;}
header img {height:40px;}
#gameCanvas {display:block; margin:auto; border-radius:12px; background:#87CEEB;}
#btnMenu, #btnIniciar {position:absolute; top:15px; right:15px; padding:8px 12px; background:#0d47a1; color:white; border:none; border-radius:8px; cursor:pointer; z-index:10;}
#btnMenu:hover, #btnIniciar:hover {background:#1565c0;}
#btnIniciar {right:150px;}
footer {margin-top:10px; font-size:13px; color:#555; text-align:center;}
</style>
</head>
<body>

<header>
    <img src="imagens/logo.png" alt="Logo Menongue">
    Corrida Menongue - Subway Surf 3D Matem√°tica
</header>

<button id="btnMenu" onclick="voltarMenu()">‚¨Ö Voltar ao Menu Inicial</button>
<button id="btnIniciar" onclick="iniciarJogo()">‚ñ∂ Iniciar Corrida</button>

<canvas id="gameCanvas" width="800" height="500"></canvas>

<footer>Administra√ß√£o Municipal de Menongue | Dire√ß√£o Municipal da Educa√ß√£o</footer>

<script src="bancoPerguntas.js"></script>

<script>
// ===== CONFIGURA√á√ÉO =====
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let width = canvas.width;
let height = canvas.height;

// Fundo parallax 3D
const fundoCamadas = [
  {img: new Image(), y:0, velocidade:1.5}, // pr√©dios atr√°s
  {img: new Image(), y:0, velocidade:3},   // ruas
];
fundoCamadas[0].img.src="imagens/camada1.png"; 
fundoCamadas[1].img.src="imagens/camada2.png";

// Avatar africano (spritesheet)
const jogadorSprite = new Image();
jogadorSprite.src = "imagens/jogador.png";

// Sons
const somAcerto = new Audio("sons/acerto.mp3");
const somErro = new Audio("sons/erro.mp3");
const somPulo = new Audio("sons/pulo.mp3");
const somCorrida = new Audio("sons/corrida.mp3");
somCorrida.loop = true; somCorrida.volume = 0.2;

// Jogador
const faixasX = [150, 350, 550];
let jogador = {x:faixasX[1], y:380, largura:70, altura:70, faixa:1, vidas:3, estado:"corrida", frame:0, frameCount:0, yOffset:0};

// Perguntas / bal√µes / moedas / obst√°culos
let perguntaAtual, baloes=[], moedas=[], obstaculos=[], pontos=0, velocidadeBaloes=5, jogoAtivo=false, perguntaCor="black";

// Spritesheet config
const spriteWidth=70, spriteHeight=70, animFrames={corrida:6, pulo:4, deslize:3};

// Part√≠culas
let particulas=[];

// ===== FUN√á√ïES =====
function iniciarJogo(){
  if(typeof bancoPerguntas === "undefined"){ alert("bancoPerguntas.js n√£o carregado!"); return; }
  pontos=0; jogador.vidas=3; jogoAtivo=true; baloes=[]; moedas=[]; obstaculos=[]; jogador.yOffset=0;
  gerarPergunta(); gerarObstaculosEMoedas();
  document.addEventListener("keydown", moverJogador);
  document.addEventListener("touchstart", touchControle);
  somCorrida.play();
  document.getElementById("btnIniciar").style.display="none";
  requestAnimationFrame(loop);
}

// Perguntas
function gerarPergunta(){
  perguntaAtual = bancoPerguntas[Math.floor(Math.random()*bancoPerguntas.length)];
  baloes=[];
  for(let i=0;i<3;i++){
    baloes.push({
      x:faixasX[i], 
      y:-100, 
      largura:120, 
      altura:60, 
      texto:perguntaAtual.opcoes[i], 
      correta:i===perguntaAtual.resposta,
      offsetY:0,
      pulse:0
    });
  }
}

// Obst√°culos e moedas
function gerarObstaculosEMoedas(){
  for(let i=0;i<3;i++){
    moedas.push({x:faixasX[i]+10, y:-Math.random()*800, largura:40, altura:40, tipo:"moeda", brilho:Math.random()*Math.PI*2});
    obstaculos.push({x:faixasX[i], y:-Math.random()*1200, largura:60, altura:60, tipo:"obstaculo"});
  }
}

// Controle teclado
function moverJogador(e){
  if(!jogoAtivo) return;
  if(e.key==="ArrowLeft" && jogador.faixa>0){ jogador.faixa--; jogador.x=faixasX[jogador.faixa]; }
  if(e.key==="ArrowRight" && jogador.faixa<2){ jogador.faixa++; jogador.x=faixasX[jogador.faixa]; }
  if(e.key==="ArrowUp" && jogador.estado==="corrida"){ jogador.estado="pulo"; jogador.frame=0; jogador.frameCount=0; somPulo.play(); }
  if(e.key==="ArrowDown" && jogador.estado==="corrida"){ jogador.estado="deslize"; jogador.frame=0; jogador.frameCount=0; }
}

// Controle mobile
function touchControle(e){
  let touchX = e.touches[0].clientX;
  if(touchX < window.innerWidth/2 && jogador.faixa>0){ jogador.faixa--; jogador.x=faixasX[jogador.faixa]; }
  else if(touchX >= window.innerWidth/2 && jogador.faixa<2){ jogador.faixa++; jogador.x=faixasX[jogador.faixa]; }
}

// Desenhar jogador
function desenharJogador(){
  let linha = jogador.estado==="corrida"?0:jogador.estado==="pulo"?1:2;
  if(jogador.estado==="pulo") jogador.yOffset = -Math.sin((jogador.frameCount/animFrames.pulo)*Math.PI)*100;
  else if(jogador.estado==="deslize") jogador.yOffset = 20;
  else jogador.yOffset = 0;
  ctx.drawImage(jogadorSprite, spriteWidth*jogador.frame, spriteHeight*linha, spriteWidth, spriteHeight, jogador.x, jogador.y+jogador.yOffset, jogador.largura, jogador.altura);
  jogador.frameCount++;
  if(jogador.frameCount%8===0){
    jogador.frame++;
    if(jogador.estado==="corrida" && jogador.frame>=animFrames.corrida) jogador.frame=0;
    if(jogador.estado==="pulo" && jogador.frame>=animFrames.pulo) jogador.estado="corrida";
    if(jogador.estado==="deslize" && jogador.frame>=animFrames.deslize) jogador.estado="corrida";
  }
}

// Criar part√≠culas
function criarParticula(x,y,cor="yellow"){
  particulas.push({x,y,r:3,vy:Math.random()*2+1, alpha:1, cor});
}

// ===== LOOP PRINCIPAL =====
function loop(){
  if(!jogoAtivo) return;

  // Fundo 3D parallax
  fundoCamadas.forEach(c=>{
    c.y += c.velocidade;
    if(c.y >= canvas.height) c.y = 0;
    ctx.drawImage(c.img,0,c.y,width,height);
    ctx.drawImage(c.img,0,c.y-height,width,height);
  });

  // Pergunta com pulse
  perguntaCor = perguntaCor==="black"?"white":"black";
  ctx.fillStyle=perguntaCor;
  ctx.font="28px Arial";
  ctx.fillText(perguntaAtual.pergunta, 20, 50);

  // Pontos e vidas
  ctx.fillStyle="white";
  ctx.font="18px Arial";
  ctx.fillText(`Pontos: ${pontos}`,20,30);
  ctx.fillText(`Vidas: ${jogador.vidas}`,150,30);

  // Jogador
  desenharJogador();

  // Bal√µes / perguntas com pulse
  baloes.forEach((b)=>{
    b.y += velocidadeBaloes;
    b.pulse += 0.1;
    let pulseOffset = Math.sin(b.pulse)*5;
    ctx.fillStyle="orange"; ctx.fillRect(b.x,b.y+pulseOffset,b.largura,b.altura);
    ctx.fillStyle="black"; ctx.font="18px Arial"; ctx.fillText(b.texto, b.x+20, b.y+35+pulseOffset);

    if(jogador.x < b.x + b.largura && jogador.x + jogador.largura > b.x &&
       jogador.y+jogador.yOffset < b.y + b.altura+pulseOffset && jogador.y+jogador.altura > b.y+pulseOffset){
      if(b.correta){ pontos++; somAcerto.play(); gerarPergunta(); }
      else{ jogador.vidas--; somErro.play(); if(jogador.vidas<=0) gameOver(); else gerarPergunta(); }
    }
    if(b.y>height) gerarPergunta();
  });

  // Moedas animadas
  moedas.forEach(m=>{
    m.y += 4;
    m.brilho += 0.1;
    ctx.fillStyle=`rgba(255,215,0,${0.6 + 0.4*Math.sin(m.brilho)})`;
    ctx.beginPath();
    ctx.arc(m.x+20,m.y+20,15 + Math.sin(m.brilho)*3,0,Math.PI*2);
    ctx.fill();

    if(jogador.x < m.x + m.largura && jogador.x + jogador.largura > m.x &&
       jogador.y+jogador.yOffset < m.y + m.altura && jogador.y+jogador.altura > m.y){
      pontos += 2; criarParticula(jogador.x+jogador.largura/2,jogador.y); m.y=-Math.random()*800; somAcerto.play();
    }
    if(m.y>height) m.y=-Math.random()*800;
  });

  // Obst√°culos
  obstaculos.forEach(o=>{
    o.y += 6;
    ctx.fillStyle="red"; ctx.fillRect(o.x,o.y,o.largura,o.altura);
    if(jogador.x < o.x + o.largura && jogador.x + jogador.largura > o.x &&
       jogador.y+jogador.yOffset < o.y + o.altura && jogador.y+jogador.altura > o.y){
      jogador.vidas--; criarParticula(jogador.x+jogador.largura/2,jogador.y+jogador.altura/2,"red"); somErro.play(); o.y=-Math.random()*1200;
      if(jogador.vidas<=0) gameOver();
    }
    if(o.y>height) o.y=-Math.random()*1200;
  });

  // Part√≠culas
  particulas.forEach((p,i)=>{
    ctx.fillStyle = `rgba(255,255,0,${p.alpha})`;
    if(p.cor==="red") ctx.fillStyle = `rgba(255,0,0,${p.alpha})`;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
    p.y+=p.vy;
    p.alpha-=0.03;
    if(p.alpha<=0) particulas.splice(i,1);
  });

  requestAnimationFrame(loop);
}

function gameOver(){
  jogoAtivo=false;
  somCorrida.pause();
  alert(`üíÄ Fim do jogo! Pontua√ß√£o: ${pontos}`);
  location.reload();
}

function voltarMenu(){ location.href="index.html"; }
</script>

</body>
</html>
