<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Corrida Menongue - Menongue Educa</title>
<style>
/* ===== RESET E ESTILO BASE ===== */
* {margin:0; padding:0; box-sizing:border-box;}
body {font-family:Poppins,sans-serif; overflow:hidden; background:#f4f8fb;}
header {background:#0d47a1; color:white; padding:10px 15px; display:flex; align-items:center; gap:10px; font-size:18px; font-weight:600;}
header img {height:40px;}
#gameCanvas {display:block; margin:auto; border-radius:12px; background:#333;}
#btnMenu {position:absolute; top:15px; right:15px; padding:8px 12px; background:#0d47a1; color:white; border:none; border-radius:8px; cursor:pointer; z-index:10;}
#btnMenu:hover {background:#1565c0;}
footer {margin-top:10px; font-size:13px; color:#555; text-align:center;}

/* Responsivo */
@media (max-width:768px){
  #gameCanvas {width:95%; height:auto;}
}
</style>
</head>
<body>

<header>
    <img src="imagens/logo.png" alt="Logo Menongue">
    Corrida Menongue - Menongue Educa
</header>

<button id="btnMenu" onclick="voltarMenu()">⬅ Voltar ao Menu Inicial</button>

<canvas id="gameCanvas" width="800" height="500"></canvas>

<footer>Administração Municipal de Menongue | Direção Municipal da Educação</footer>

<script src="bancoPerguntas.js"></script> <!-- Banco de perguntas -->

<script>
// ===== CONFIGURAÇÃO =====
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let width = canvas.width;
let height = canvas.height;

// Fundo
const fundoImg = new Image();
fundoImg.src = "imagens/menonguestreet.png";

// Avatar africano
const jogadorImg = new Image();
jogadorImg.src = "imagens/jogador.png";

// Sons opcionais
const somAcerto = new Audio("sons/acerto.mp3");
const somErro = new Audio("sons/erro.mp3");

// Jogador
const faixasX = [150, 350, 550];
let jogador = {x:faixasX[1], y:380, largura:70, altura:70, faixa:1, estado:"corrida", yOffset:0};

// Obstáculos / itens
let itens = [];

// Perguntas
let perguntaAtual;
let pontos=0;

// Controle do jogo
let jogoAtivo=false;
let perguntaCor="black";

// ===== FUNÇÕES =====
function iniciarJogo(){
  if(typeof bancoPerguntas === "undefined"){ alert("bancoPerguntas.js não carregado!"); return; }
  itens = [];
  pontos = 0;
  gerarPergunta();
  jogoAtivo=true;
  document.addEventListener("keydown", moverJogador);
  document.addEventListener("touchstart", touchControle);
  requestAnimationFrame(loop);
}

function gerarPergunta(){
  perguntaAtual = bancoPerguntas[Math.floor(Math.random()*bancoPerguntas.length)];
  itens = [];
  for(let i=0;i<3;i++){
    itens.push({x:faixasX[i], y:-100, largura:120, altura:60, texto:perguntaAtual.opcoes[i], correta:i===perguntaAtual.resposta, offsetY:Math.random()*5});
  }
}

// Controle teclado
function moverJogador(e){
  if(!jogoAtivo) return;
  if(e.key==="ArrowLeft" && jogador.faixa>0){ jogador.faixa--; jogador.x=faixasX[jogador.faixa]; }
  if(e.key==="ArrowRight" && jogador.faixa<2){ jogador.faixa++; jogador.x=faixasX[jogador.faixa]; }
}

// Controle toque mobile
function touchControle(e){
  if(!jogoAtivo) return;
  let touchX = e.touches[0].clientX;
  if(touchX < window.innerWidth/2 && jogador.faixa>0){ jogador.faixa--; jogador.x=faixasX[jogador.faixa]; }
  else if(touchX >= window.innerWidth/2 && jogador.faixa<2){ jogador.faixa++; jogador.x=faixasX[jogador.faixa]; }
}

// Desenha jogador
function desenharJogador(){
  ctx.drawImage(jogadorImg,jogador.x,jogador.y+jogador.yOffset,jogador.largura,jogador.altura);
}

// Loop principal
function loop(){
  if(!jogoAtivo) return;

  // fundo fixo
  ctx.clearRect(0,0,width,height);
  ctx.drawImage(fundoImg,0,0,width,height);

  // pergunta topo
  perguntaCor = perguntaCor==="black"?"white":"black";
  ctx.fillStyle=perguntaCor;
  ctx.font="28px Arial";
  ctx.fillText(perguntaAtual.pergunta, 20, 50);

  // info pontos
  ctx.fillStyle="white";
  ctx.font="18px Arial";
  ctx.fillText(`Pontos: ${pontos}`,20,30);

  // jogador
  desenharJogador();

  // itens / balões
  itens.forEach(item=>{
    item.y += 5;
    item.offsetY = Math.sin(Date.now()/200 + item.x)*5;
    ctx.fillStyle="orange";
    ctx.fillRect(item.x,item.y+item.offsetY,item.largura,item.altura);
    ctx.fillStyle="black";
    ctx.font="18px Arial";
    ctx.fillText(item.texto, item.x+20, item.y+item.offsetY+35);

    // colisão
    if(jogador.x < item.x + item.largura && jogador.x + jogador.largura > item.x &&
       jogador.y < item.y+item.offsetY + item.altura && jogador.y + jogador.altura > item.y+item.offsetY){
      if(item.correta){ pontos++; somAcerto.play(); gerarPergunta(); }
      else{ somErro.play(); gerarPergunta(); }
    }

    if(item.y>height){ gerarPergunta(); }
  });

  requestAnimationFrame(loop);
}

// Botão voltar
function voltarMenu(){ location.href="index.html"; } // ajuste para o menu principal
</script>

</body>
</html>
